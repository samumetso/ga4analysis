#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Hotel Haven - MCP Hakee V√§√§r√§√§ Dataa
MCP n√§kee Klaus K:n dataa vaikka pit√§isi n√§hd√§ vain Hotel Havenin
"""

def mcp_wrong_data_diagnosis():
    """Diagnosoi miksi MCP hakee v√§√§r√§√§ dataa"""
    
    print("üö® MCP HAKEE V√Ñ√ÑR√Ñ√Ñ DATAA!")
    print("=" * 80)
    print()
    
    print("üìä ONGELMA:")
    print("-" * 15)
    print("‚Ä¢ MCP n√§kee Toscanini.fi referral-liikennett√§ (254 sessions)")
    print("‚Ä¢ Hotel Havenin GA4:ss√§ EI n√§y Toscanini.fi:t√§ ollenkaan")
    print("‚Ä¢ Toscanini.fi liittyy vain Klaus K:hon")
    print("‚Ä¢ JOHTOP√Ñ√ÑT√ñS: MCP hakee Klaus K:n dataa Hotel Havenin sijaan!")
    print()
    
    print("üîç TODISTEET:")
    print("-" * 15)
    print()
    print("MCP N√ÑKEE:")
    print("‚Ä¢ Toscanini.fi / referral: 254 sessions")
    print("‚Ä¢ Sessions yhteens√§: ~33,000")
    print("‚Ä¢ Referral-kanava: 2,242 sessions")
    print()
    print("HOTEL HAVENIN GA4 (290658078):")
    print("‚Ä¢ EI Toscanini.fi:t√§ referraleissa")
    print("‚Ä¢ Sessions yhteens√§: ? (kerro t√§m√§)")
    print("‚Ä¢ Referral-kanava: ? (kerro t√§m√§)")
    print()
    
    print("ü§î MIKSI N√ÑIN TAPAHTUU:")
    print("-" * 30)
    print()
    
    print("MAHDOLLISET SYYT:")
    print()
    print("1. üîß YMP√ÑRIST√ñMUUTTUJA EI P√ÑIVITTYNYT")
    print("   ‚Ä¢ export GA4_PROPERTY_ID=290658078 ei vaikuttanut")
    print("   ‚Ä¢ MCP k√§ytt√§√§ edelleen vanhaa ID:t√§ (290818724)")
    print("   ‚Ä¢ Tarvitaan MCP:n restart tai cache-tyhjennys")
    print()
    
    print("2. üéØ MCP:N SIS√ÑINEN CACHE")
    print("   ‚Ä¢ MCP tallentaa dataa v√§limuistiin")
    print("   ‚Ä¢ Vanha data (Klaus K) on cachessa")
    print("   ‚Ä¢ Property ID vaihto ei tyhjenn√§ cachea")
    print()
    
    print("3. üîó ACCOUNT-TASON OIKEUDET SEKOITTAVAT")
    print("   ‚Ä¢ MCP:ll√§ on oikeudet molempiin property:ihin")
    print("   ‚Ä¢ API aggregoi dataa automaattisesti")
    print("   ‚Ä¢ Ei osaa erottaa property:j√§ toisistaan")
    print()
    
    print("4. üåê MCP:N KONFIGURAATIO-ONGELMA")
    print("   ‚Ä¢ MCP:n sis√§inen konfiguraatio v√§√§r√§")
    print("   ‚Ä¢ Kovakoodattu property ID")
    print("   ‚Ä¢ Ymp√§rist√∂muuttuja ei vaikuta")
    print()
    
    print("üîß DIAGNOOSI TESTIT:")
    print("-" * 25)
    print()
    
    print("TESTI 1: TARKISTA YMP√ÑRIST√ñMUUTTUJA")
    print("‚Ä¢ echo $GA4_PROPERTY_ID")
    print("‚Ä¢ Pit√§isi n√§ytt√§√§: 290658078")
    print()
    
    print("TESTI 2: POISTA KLAUS K OIKEUDET")
    print("‚Ä¢ Poista MCP:lt√§ oikeudet Klaus K property:yn")
    print("‚Ä¢ Testaa uudelleen")
    print("‚Ä¢ Jos Toscanini.fi katoaa ‚Üí ONGELMA RATKAISTU")
    print()
    
    print("TESTI 3: MCP RESTART")
    print("‚Ä¢ Sammuta MCP prosessi")
    print("‚Ä¢ K√§ynnist√§ uudelleen")
    print("‚Ä¢ Testaa uudelleen")
    print()
    
    print("üí° TODENN√ÑK√ñISIN SYY:")
    print("-" * 30)
    print()
    print("üéØ ACCOUNT-TASON OIKEUDET + API AGGREGAATIO")
    print()
    print("SELITYS:")
    print("‚Ä¢ MCP:ll√§ on Account-tason oikeudet")
    print("‚Ä¢ GA4 API aggregoi datan kaikista property:ist√§")
    print("‚Ä¢ Vaikka pyyd√§mme Property 290658078 dataa")
    print("‚Ä¢ API palauttaa koko Account:in datan")
    print("‚Ä¢ Sis√§lt√§√§ Hotel Haven + Klaus K + muut")
    print()
    print("SIKSI:")
    print("‚Ä¢ MCP n√§kee Toscanini.fi:t√§ (Klaus K:sta)")
    print("‚Ä¢ Hotel Havenin GA4 ei n√§e sit√§ (vain oma property)")
    print("‚Ä¢ Luvut eiv√§t t√§sm√§√§")
    print()
    
    print("üöÄ RATKAISU:")
    print("-" * 15)
    print()
    
    print("V√ÑLIT√ñN TOIMENPIDE:")
    print("1. üîß POISTA MCP:LT√Ñ KLAUS K OIKEUDET")
    print("   ‚Ä¢ Admin > Property Access Management")
    print("   ‚Ä¢ Poista ga4analysis@... Klaus K property:st√§")
    print("   ‚Ä¢ J√§t√§ vain Hotel Haven oikeudet")
    print()
    
    print("2. üßπ TYHJENN√Ñ MCP CACHE")
    print("   ‚Ä¢ Restart MCP prosessi")
    print("   ‚Ä¢ Tai tyhjenn√§ cache jos mahdollista")
    print()
    
    print("3. ‚úÖ TESTAA UUDELLEEN")
    print("   ‚Ä¢ Hae MCP:ll√§ referral-l√§hteet")
    print("   ‚Ä¢ Toscanini.fi:n pit√§isi kadota")
    print("   ‚Ä¢ Luvut pit√§isi t√§sm√§t√§ GA4:n kanssa")
    print()
    
    print("üéØ ODOTETTU TULOS:")
    print("-" * 25)
    print()
    print("KUN KLAUS K OIKEUDET POISTETTU:")
    print("‚Ä¢ MCP ei n√§e en√§√§ Toscanini.fi:t√§")
    print("‚Ä¢ Sessions laskee ~33,000 ‚Üí ~30,000 (arvio)")
    print("‚Ä¢ Referral-liikenne laskee 2,242 ‚Üí ~2,000")
    print("‚Ä¢ Luvut alkavat t√§sm√§t√§ GA4:n kanssa")
    print()
    
    print("üìä VERTAILUTESTI:")
    print("-" * 20)
    print()
    print("ENNEN (nyt):")
    print("‚Ä¢ MCP Sessions: ~33,000")
    print("‚Ä¢ MCP Toscanini.fi: 254")
    print("‚Ä¢ GA4 Sessions: ? (kerro)")
    print("‚Ä¢ GA4 Toscanini.fi: 0")
    print()
    print("J√ÑLKEEN (odotettu):")
    print("‚Ä¢ MCP Sessions: ~GA4:n luku")
    print("‚Ä¢ MCP Toscanini.fi: 0")
    print("‚Ä¢ GA4 Sessions: sama")
    print("‚Ä¢ GA4 Toscanini.fi: 0")
    print()
    
    print("üí≠ JOHTOP√Ñ√ÑT√ñS:")
    print("-" * 20)
    print()
    print("MCP:n ongelma on todenn√§k√∂isesti:")
    print("‚Ä¢ Liian laajat oikeudet (Account vs Property)")
    print("‚Ä¢ API aggregoi dataa automaattisesti")
    print("‚Ä¢ Ei osaa rajata yhteen property:yn")
    print()
    print("RATKAISU:")
    print("‚Ä¢ Anna MCP:lle vain Hotel Haven property oikeudet")
    print("‚Ä¢ Poista kaikki muut property oikeudet")
    print("‚Ä¢ Testaa ett√§ data t√§sm√§√§")
    print()
    
    print("üö® SEURAAVA ASKEL:")
    print("-" * 25)
    print("Poista MCP:lt√§ Klaus K oikeudet ja testaa uudelleen!")

if __name__ == "__main__":
    mcp_wrong_data_diagnosis()
